.TH "ghorizon" "1" "30 January 2017" "IPW v2" "IPW User Commands"
.SH NAME
.PP
\fBghorizon\fP - horizon for one direction (global-scale)
.SH SYNOPSIS
.sp
.nf
.ft CR
\fBghorizon\fP [ \fB-a\fP \fIphi\fP ] [ \fB-b\fP ] [ \fB-s\fP \fIsolar_image\fP ] [ \fB-z\fP ]
      [ \fB-m\fP \fImask\fP ] [ \fB-e\fP \fIelev_max\fP ] [\fIimage\fP]
.ft R
.fi
.SH DESCRIPTION
.PP
Ghorizon is part of a family of large area, or "global", scale radiation
transfer simulation, and solar/terrain geometry calculation tools,
developed after the small-scale radiation transfer and terrain processing
tools, developed at UCSB by Jeff Dozier, Jim Frew, and Ralph Dubayah.
.PP
All of the global-scale tools are designated by the "g" prefix in
front of the small-scale tool's name.  These tools assume that solar
geometry, atmospheric properties, and sun rise and sun set vary over
the grid; they also correct for earth curvature.
.PP
The global-scale radiation transfer tools can be applied to areas of
size, up to the entire earth.  The global-scale radiation transfer tools
were originally developed by Kelly Longley, Oregon State University,
at the Corvallis, Oregon, EPA lab, in the early 1990's.
.PP
Ghorizon is the global-scale version of the pgm horizon.  It is,
however, implemented as a C-program, rather than as a shell script.
Ghorizon finds cosines of horizon angles for a global-scale elevation
image along the given azimuth(s).  The azimuth may be specified as a
single value for every pixel (\fB-a option) or alternatively by a single-
band image of azimuth angles (specified by \fB-s option).  The output
image is cosine of the horizon angle measured from vertical.  All
azimuths are in degrees from South (+E,-W).
.PP
If the \fB-b option is specified, the output image is a mask image for
sun below the horizon (output pixel 1 for sun above horizon, 0 for
sun below horizon).  In this case the \fB-s option is required and
the solar_image is a two-band image where band 0 is cosine solar zenith
angle (or zenith angle (deg) if \fB-z is set) and band 1 is solar azimuth
as degrees_ccw from south (+E,-W) (output from program gsunlight).
.PP
There is an option to specify the maximum elevation in the elevation
file.  If specified, the horizon calculations may run much faster
since the maximum elevation is used to calculate the maximum distance
to search for the horizon.  If not specified, the maximum value in
the floating point quantization will be used.
.SH OPTIONS
.TP
\fB-a\fP \fIphi\fP
azimuth specified as degrees from South (+E,-W)
(note \fB-a and \fB-s options mutually exclusive)
.sp
.TP
\fB-b\fP
"sun below horizon" mask output option
.sp
.TP
\fB-s\fP \fIsolar_image\fP
solar azimuth image (degrees from South, +E,-W)
or solar zenith (degrees) and azimuth if \fB-b specified
From program gsunlight (must be in geodetic projection).
.sp
.TP
\fB-z\fP
flag for solar zenith angle included in solar_image
(default: cosine solar zenith angle)
.sp
.TP
\fB-m\fP \fImask\fP
mask image
.sp
.TP
\fB-e\fP \fIelev_max\fP
maximum elevation in file
.SH OPERANDS
.TP
[\fIimage\fP]
	image	input elevation file (must be in geodetic projection)
		(defaults to stdin)
.sp
.SH EXAMPLES
.PP
To compute northwest horizons over a dem of the US:
.sp
.nf
.ft CR
	ghorizon -a -135 US_dem
.ft R
.fi

.PP
To produce a mask of all points in the US_dem that cannot see the
sun at 6AM, GMT, on Feb 15, 1990:
.sp
.nf
.ft CR
	mkgeoh ... | gsunlight -t 1990,02,15,06 >solar_image
	ghorizon -b -s solar_image US_dem
.ft R
.fi

.PP
(i.e., any pixels that would be shadowed by adjacent terrain at
the solar zenith and azimuths on this date and time,
would be masked as 0.)
.SH FILES
.sp
.nf
.ft CR
     None
.ft R
.fi
.SH DIAGNOSTICS
.sp
.TP
All images must be in geodetic projection (headers.c):
.br
	Illegal latitudes in GEO header
	Illegal longitudes in GEO header
	Input image has no geodetic header - must be lat/lon projection
.SH RESTRICTIONS
.PP
input elevation and solar azimuth images must be in lat/lon
geographic projection: latitudes in decimal degrees (90 N to -90 S),
longitudes in continuous decimal degrees (-180 to 180 deg +E/-W)
.SH HISTORY
.TP
Jan 1991
	Written by Kelly Longley, Oregon State University,
Environmental Research Laboratory, Corvallis OR
.TP
May 1991
	Added inverse distance squared interpolation for
elevation, by K. Longley, OSU, EPA ERL-C
.TP
Jun 1991
	Changed elevation interpolation to bilinear
interpolation, by K. Longley, OSU, EPA ERL-C
.TP
Aug 1992
	Use ANSI-C prototypes for all functions.  Changed way
hypot is called to fix bug in AIX.  Dana Jacobsen, ERL-C
.TP
May 1995
	Inlined call to iobuf() to fix bug with Solaris 2.4/gcc.
Dana Jacobsen, ERL-C
.TP
Jul 1995
	Changed calls to atan2 to PI definition.
Dana Jacobsen, ERL-C
.SH BUGS
.PP
None that we know of
.SH SEE ALSO
.TP
IPW
	\fBgsunlight\fP,
\fBgtoporad\fP,
\fBgtoporad.24\fP,
\fBgtopquad\fP,
\fBhorizon\fP,
\fBmkgeoh\fP,
	\fBstoporad\fP,
\fBsunlight\fP,
\fBtoporad\fP,
\fBtoporad.24\fP,
\fBtopquad\fP
.PP
Dozier, J., 1980.  "A clear-sky spectral solar radiation model for
	snow-covered mountainous terrain".  Water Resources Research,
	vol. 16, pp. 709-718.
.PP
Dozier, J., J. Bruno, and P. Downey, "A faster solution to the
	horizon problem", Computers and Geosciences, volume 7,
	number 2, pp. 145-151, 1981.
.PP
Dozier, J., and J. Frew, 1990.  Rapid calculation of terrain parameters
	for radiation modeling from digital elevation data". IEEE
	Transactions on Geoscience and Remote Sensing, vol. 28, no. 5,
	pp. 963-969.
.PP
Marks, D., R. Dubayah, and K. Longley, 1991.  "Modeling the topographic
	and spectral variability of clear-sky solar radiation at regional
	to continental scales.  Proceedings 1991 IGARSS Symposium,
	Remote Sensing:  Global Monitoring for Earth Management, Espoo,
	Finland, Vol. 3, pp. 1711.
